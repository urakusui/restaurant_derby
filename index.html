<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ç‹å°†ãƒ€ãƒ¼ãƒ“ãƒ¼</title>
<style>
body { font-family: sans-serif; background: #f5f5f5; padding: 15px; margin: 0; color: #333; }
* { box-sizing: border-box; }
.hidden { display: none !important; }
.box { background: #fff; padding: 20px; margin-bottom: 20px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
.header-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 2px solid #eee; padding-bottom: 10px; }
h2, h3 { margin: 0; color: #B71C1C; }
input, button { width: 100%; margin: 8px 0; padding: 12px; font-size: 16px; border-radius: 6px; border: 1px solid #ccc; }
button { border: none; font-weight: bold; color: #fff; cursor: pointer; transition: opacity 0.2s; }
button:active { transform: scale(0.98); }
.btn-main { background: #B71C1C; }
.btn-add { background: #2E7D32; }
.btn-back { background: #616161; }
.btn-del { background: #f44336; margin-left: auto; padding: 5px 12px; font-size: 14px; cursor: pointer; }
.list-area { margin: 15px 0; max-height: 300px; overflow-y: auto; }
.list-item { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #eee; padding: 10px 0; }
.help-text { background: #fff3cd; padding: 10px; border-radius: 6px; margin-bottom: 15px; }
table { width: 100%; border-collapse: collapse; margin-top: 10px; }
th, td { border: 1px solid #ccc; padding: 10px; text-align: center; font-size: 14px; }
th { background: #eee; }
.waku-1 { color: #000; } .waku-2 { background: #333; color: #fff; }
.waku-3 { background: #f44336; color: #fff; } .waku-4 { background: #2196f3; color: #fff; }
.waku-5 { background: #ffeb3b; color: #000; } .waku-6 { background: #4caf50; color: #fff; }
.waku-7 { background: #ff9800; color: #fff; } .waku-8 { background: #ffc0cb; color: #000; }
</style>
</head>
<body>

<!-- ãƒˆãƒƒãƒ—ç”»é¢ -->
<div id="screen-menu" class="box">
  <div class="header-row">
    <h2>ç‹å°†ãƒ€ãƒ¼ãƒ“ãƒ¼</h2>
  </div>

  <div class="help-text">
    <b>éŠã³æ–¹:</b>
    <ul style="padding-left:20px; line-height:1.6;">
      <li>ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç™»éŒ²ï¼šé ¼ã‚€æ–™ç†ãƒ»ãƒ‰ãƒªãƒ³ã‚¯ã‚’3ã¤ä»¥ä¸Šå…¥åŠ›ï¼ˆæœ€å¤§8å“ï¼‰ã€‚</li>
      <li>å‡ºèµ°è¡¨ï¼šã€Œå‡ºèµ°è¡¨ã‚’ç¢ºèªã€ãƒœã‚¿ãƒ³ã§ã‚ªãƒƒã‚ºã‚’è¡¨ç¤ºã€‚</li>
      <li>äºˆæƒ³ï¼šå‚åŠ è€…ã‚’ç™»éŒ²ã—ã€æ–™ç†ã®åˆ°ç€é †ï¼ˆ1ã€œ3ç€ï¼‰ã‚’äºˆæƒ³ã€‚</li>
      <li>çµæœï¼šæ–™ç†ãŒå±Šã„ãŸé †ã«å…¥åŠ›ã—ã¦çµæœç™ºè¡¨ï¼</li>
    </ul>
  </div>

  <input id="shopName" placeholder="åº—èˆ—åï¼ˆä¾‹ï¼šå¤§é˜ªé§…å‰ç¬¬2ãƒ“ãƒ«ï¼‰">
  <input id="menuName" placeholder="ãƒ¡ãƒ‹ãƒ¥ãƒ¼åï¼ˆä¾‹ï¼šé¤ƒå­ï¼‰">
  <button type="button" class="btn-add" onclick="addMenu()">ï¼‹ ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’è¿½åŠ </button>

  <div id="menuList" class="list-area">
    <div style="text-align:center; color:#888;">ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’è¿½åŠ ã—ã¦ãã ã•ã„</div>
  </div>

  <button type="button" class="btn-main" onclick="toRaceTable()">ğŸ å‡ºèµ°è¡¨ã‚’ç¢ºèª</button>
  <button type="button" class="btn-main" onclick="showHistory()">ğŸ“œ å±¥æ­´è¡¨ç¤º</button>
  <button type="button" class="btn-back" onclick="resetAll()">ğŸ—‘ï¸ æœ€åˆã‹ã‚‰ã‚„ã‚Šç›´ã™</button>
</div>

<!-- å‡ºèµ°è¡¨ç”»é¢ -->
<div id="screen-race" class="box hidden">
  <h3>ğŸ å‡ºèµ°è¡¨</h3>
  <div id="raceTableArea"></div>
  <button type="button" class="btn-add" style="margin-top:15px;" onclick="toPlayerReg()">å‚åŠ è€…ç™»éŒ²ã¸é€²ã‚€</button>
  <button type="button" class="btn-back" onclick="show('screen-menu')">ãƒ¡ãƒ‹ãƒ¥ãƒ¼ä¿®æ­£ã«æˆ»ã‚‹</button>
</div>

<!-- å‚åŠ è€…ç™»éŒ² -->
<div id="screen-player" class="box hidden">
  <h3>ğŸ‘¤ å‚åŠ è€…ç™»éŒ²</h3>
  <input id="playerName" placeholder="åå‰ã‚’å…¥åŠ›">
  <button type="button" class="btn-add" onclick="addPlayer()">ï¼‹ å‚åŠ è€…ã‚’è¿½åŠ </button>
  <div id="playerList" class="list-area">å‚åŠ è€…ãŒã„ã¾ã›ã‚“</div>
  <button type="button" class="btn-main" onclick="startPrediction()">äºˆæƒ³ã‚’å§‹ã‚ã‚‹</button>
  <button type="button" class="btn-back" onclick="show('screen-race')">æˆ»ã‚‹</button>
</div>

<!-- äºˆæƒ³ç”»é¢ -->
<div id="screen-predict" class="box hidden">
  <h3 id="predictTitle">äºˆæƒ³ç”»é¢</h3>
  <p>1ç€ã€œ3ç€ã‚’é¸ã‚“ã§ãã ã•ã„</p>
  <div id="predictInputs"></div>
  <div id="menuButtons"></div>
  <button type="button" class="btn-main" onclick="confirmPrediction()">æ±ºå®š</button>
</div>

<!-- çµæœå…¥åŠ› -->
<div id="screen-result" class="box hidden">
  <h3>ğŸ† çµæœå…¥åŠ›</h3>
  <p>å±Šã„ãŸæ–™ç†ã‚’é †ç•ªã«é¸ã‚“ã§ãã ã•ã„</p>
  <div id="resultInputs"></div>
  <div id="resultButtons"></div>
  <button type="button" class="btn-main" onclick="showResult()">çµæœç™ºè¡¨ï¼</button>
</div>

<!-- çµæœç™ºè¡¨ -->
<div id="screen-ticket" class="box hidden">
  <div style="text-align:center; border: 2px solid #333; padding: 20px; border-radius: 10px;">
    <h2 id="finalTitle">çµæœç™ºè¡¨</h2>
    <div id="finalResult" style="font-size:16px; margin:15px 0; line-height:1.6;"></div>
    <div id="finalOdds" style="color:#B71C1C; font-size:22px; font-weight:900;"></div>
    <hr>
    <div id="finalWinners" style="color:green; font-weight:bold; font-size:18px;"></div>
  </div>
  <button type="button" class="btn-back" onclick="resetAll()">ã‚¿ã‚¤ãƒˆãƒ«ã¸æˆ»ã‚‹</button>
</div>

<!-- å±¥æ­´è¡¨ç¤ºç”»é¢ -->
<div id="screen-history" class="box hidden">
  <h3>ğŸ“œ ãƒ¬ãƒ¼ã‚¹å±¥æ­´</h3>
  <div id="historyList" class="list-area">å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“</div>
  <button type="button" class="btn-back" onclick="show('screen-menu')">æˆ»ã‚‹</button>
</div>

<script>
let menus = [];
let players = [];
let currentPlayerIndex = 0;
let tempPrediction = [null,null,null];
let tempResult = [null,null,null];
let activeSlot = 0;
let history = []; // æœ€å¤§10ä»¶ã®å±¥æ­´

const $ = id => document.getElementById(id);

function show(screenId) {
  ['screen-menu','screen-race','screen-player','screen-predict','screen-result','screen-ticket','screen-history'].forEach(id=>{
    $(id).classList.add('hidden');
  });
  $(screenId).classList.remove('hidden');
  window.scrollTo(0,0);
}

// --- ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç®¡ç† ---
function addMenu() {
  const val = $('menuName').value.trim();
  if(!val) return;
  const odds = (Math.random()*8+1.1).toFixed(1);
  menus.push({name:val,odds:odds});
  $('menuName').value='';
  renderMenus();
  if(menus.length >= 3) toRaceTable();
}

function renderMenus() {
  const list = $('menuList');
  if(menus.length===0){
    list.innerHTML='<div style="text-align:center; color:#888;">ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’è¿½åŠ ã—ã¦ãã ã•ã„</div>';
    return;
  }
  list.innerHTML = menus.map((m,i)=>`
    <div class="list-item">
      <span style="font-weight:bold;">${i+1}. ${m.name}</span>
      <button type="button" class="btn-del" onclick="removeMenu(${i})">å‰Šé™¤</button>
    </div>
  `).join('');
}

function removeMenu(i){ menus.splice(i,1); renderMenus(); }

// --- å‡ºèµ°è¡¨ ---
function toRaceTable() {
  if(menus.length<3) return alert("ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’3ã¤ä»¥ä¸Šç™»éŒ²ã—ã¦ãã ã•ã„ï¼ˆãƒ¬ãƒ¼ã‚¹ãŒæˆç«‹ã—ã¾ã›ã‚“ï¼‰");
  let html='<table><tr><th>æ </th><th>ãƒ¡ãƒ‹ãƒ¥ãƒ¼å</th><th>ã‚ªãƒƒã‚º</th></tr>';
  menus.forEach((m,i)=>{
    const waku = Math.min(8, Math.floor(i/Math.max(1,menus.length/8))+1);
    html+=`<tr><td class="waku-${waku}">${i+1}</td><td>${m.name}</td><td>${m.odds}å€</td></tr>`;
  });
  html+='</table>';
  $('raceTableArea').innerHTML = html;
  show('screen-race');
}

// --- å‚åŠ è€…ç®¡ç† ---
function toPlayerReg(){ show('screen-player'); }
function addPlayer(){ const val=$('playerName').value.trim(); if(!val) return; players.push({name:val,prediction:[]}); $('playerName').value=''; renderPlayers(); }
function renderPlayers(){ const list=$('playerList'); if(players.length===0){ list.innerHTML='å‚åŠ è€…ãŒã„ã¾ã›ã‚“'; return;} list.innerHTML = players.map(p=>`<div class="list-item">ğŸ‘¤ ${p.name}</div>`).join(''); }

// --- äºˆæƒ³ ---
function startPrediction(){ if(players.length===0)return alert("å‚åŠ è€…ã‚’è¿½åŠ ã—ã¦ãã ã•ã„"); currentPlayerIndex=0; setupPredictionScreen();}
function setupPredictionScreen(){ if(currentPlayerIndex>=players.length){ setupResultScreen(); return;} const p=players[currentPlayerIndex]; $('predictTitle').innerText=`äºˆæƒ³ï¼š${p.name} ã•ã‚“`; tempPrediction=[null,null,null]; activeSlot=0; renderPredictionUI(); show('screen-predict'); }
function renderPredictionUI(){ const labels=['1ç€','2ç€','3ç€']; let html=''; for(let i=0;i<3;i++){ const menuIdx=tempPrediction[i]; const text=menuIdx!==null?menus[menuIdx].name:'ï¼ˆæœªé¸æŠï¼‰'; const activeStyle=(i===activeSlot)?'background:#FFF3E0;border:2px solid orange;':'background:#fff;'; html+=`<div style="padding:10px;margin:5px 0;border:1px solid #ddd;border-radius:4px;${activeStyle}" onclick="activeSlot=${i}; renderPredictionUI();"><b>${labels[i]}</b> : ${text}</div>`;} $('predictInputs').innerHTML=html; $('menuButtons').innerHTML=menus.map((m,i)=>`<button type="button" style="margin:4px 0;background:#eee;color:#333;text-align:left;" onclick="selectMenuForPrediction(${i})" ${tempPrediction.includes(i)?'disabled style="opacity:0.3"':''}>${i+1}. ${m.name} (${m.odds}å€)</button>`).join('');}
function selectMenuForPrediction(idx){ tempPrediction[activeSlot]=idx; const next=tempPrediction.indexOf(null); if(next!==-1) activeSlot=next; renderPredictionUI(); }
function confirmPrediction(){ if(tempPrediction.includes(null))return alert("1ç€ã‹ã‚‰3ç€ã¾ã§ã™ã¹ã¦é¸ã‚“ã§ãã ã•ã„"); players[currentPlayerIndex].prediction=[...tempPrediction]; currentPlayerIndex++; setupPredictionScreen(); }

// --- çµæœå…¥åŠ› ---
function setupResultScreen(){ tempResult=[null,null,null]; activeSlot=0; renderResultUI(); show('screen-result'); }
function renderResultUI(){ const labels=['1ç€','2ç€','3ç€']; let html=''; for(let i=0;i<3;i++){ const menuIdx=tempResult[i]; const text=menuIdx!==null?menus[menuIdx].name:'ï¼ˆæœªé¸æŠï¼‰'; const activeStyle=(i===activeSlot)?'background:#FFF3E0;border:2px solid orange;':'background:#fff;'; html+=`<div style="padding:10px;margin:5px 0;border:1px solid #ddd;border-radius:4px;${activeStyle}" onclick="activeSlot=${i}; renderResultUI();"><b>${labels[i]}</b> : ${text}</div>`;} $('resultInputs').innerHTML=html; $('resultButtons').innerHTML=menus.map((m,i)=>`<button type="button" style="margin:4px 0;background:#eee;color:#333;text-align:left;" onclick="selectMenuForResult(${i})" ${tempResult.includes(i)?'disabled style="opacity:0.3"':''}>${i+1}. ${m.name}</button>`).join(''); }
function selectMenuForResult(idx){ tempResult[activeSlot]=idx; const next=tempResult.indexOf(null); if(next!==-1) activeSlot=next; renderResultUI(); }

// --- çµæœç™ºè¡¨ï¼ˆå±¥æ­´ä¿å­˜è¿½åŠ ï¼‰ ---
function showResult(){
  if(tempResult.includes(null))return alert("ã™ã¹ã¦ã®çµæœã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
  const shop=$('shopName').value||'ç‹å°†';
  $('finalTitle').innerText=`${shop} ã‚°ãƒ©ãƒ³ãƒ—ãƒª`;
  let totalOdds=1.0;
  const resHtml=tempResult.map((idx,i)=>{
    totalOdds*=parseFloat(menus[idx].odds);
    return `${i+1}ç€: ${menus[idx].name}`;
  }).join('<br>');
  $('finalResult').innerHTML=resHtml;
  $('finalOdds').innerText=`3é€£å˜: ${totalOdds.toFixed(1)}å€`;
  const winners=players.filter(p=>JSON.stringify(p.prediction)===JSON.stringify(tempResult));
  $('finalWinners').innerHTML = winners.length>0?`ğŸ‰ çš„ä¸­ï¼<br>${winners.map(w=>w.name).join(', ')}`:'çš„ä¸­è€…ãªã—...';

  // --- å±¥æ­´ã«è¿½åŠ  ---
  const now = new Date();
  const historyEntry = {
    datetime: now.toLocaleString(),
    shop: shop,
    raceName: "ã‚°ãƒ©ãƒ³ãƒ—ãƒª",
    results: tempResult.map((idx,i)=>({rank:i+1, menu:menus[idx].name, odds:menus[idx].odds}))
  };
  history.unshift(historyEntry);
  if(history.length>10) history.pop();

  show('screen-ticket');
}

// --- å±¥æ­´è¡¨ç¤º ---
function showHistory(){
  const list = $('historyList');
  if(history.length===0){ list.innerHTML='å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“'; show('screen-history'); return; }
  list.innerHTML = history.map(h=>{
    let rows = h.results.map(r=>`<tr><td>${r.rank}</td><td>${r.menu}</td><td>${r.odds}å€</td></tr>`).join('');
    return `<div style="margin-bottom:15px; border:1px solid #ccc; padding:10px; border-radius:6px;">
      <b>${h.datetime} / ${h.shop} / ${h.raceName}</b>
      <table><tr><th>ç€é †</th><th>ãƒ¡ãƒ‹ãƒ¥ãƒ¼å</th><th>ç¢ºå®šã‚ªãƒƒã‚º</th></tr>${rows}</table>
    </div>`;
  }).join('');
  show('screen-history');
}

// --- åˆæœŸåŒ– ---
function resetAll(){ if(!confirm("ãƒ‡ãƒ¼ã‚¿ã‚’ã™ã¹ã¦æ¶ˆã—ã¦æœ€åˆã‹ã‚‰æˆ»ã‚Šã¾ã™ã‹ï¼Ÿ")) return; menus=[]; players=[]; currentPlayerIndex=0; $('menuList').innerHTML='<div style="text-align:center; color:#888;">ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’è¿½åŠ ã—ã¦ãã ã•ã„</div>'; $('playerList').innerHTML='å‚åŠ è€…ãŒã„ã¾ã›ã‚“'; $('shopName').value=''; $('menuName').value=''; $('playerName').value=''; show('screen-menu'); }

</script>
</body>
</html>
