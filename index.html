<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ç‹å°†ãƒ€ãƒ¼ãƒ“ãƒ¼ å®Œå…¨ä¿®æ­£ç‰ˆ</title>
<style>
/* åŸºæœ¬è¨­å®š */
body { font-family: sans-serif; background: #f5f5f5; padding: 15px; margin: 0; color: #333; }
* { box-sizing: border-box; }

/* ç”»é¢ã®è¡¨ç¤ºãƒ»éè¡¨ç¤ºåˆ¶å¾¡ï¼ˆæœ€é‡è¦ï¼‰ */
.hidden { display: none !important; }

/* ã‚«ãƒ¼ãƒ‰ã‚¹ã‚¿ã‚¤ãƒ« */
.box { 
  background: #fff; 
  padding: 20px; 
  margin-bottom: 20px; 
  border-radius: 12px; 
  box-shadow: 0 4px 12px rgba(0,0,0,0.1); 
}

/* ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆã‚¿ã‚¤ãƒˆãƒ«ã¨ï¼Ÿãƒœã‚¿ãƒ³ã‚’æ¨ªä¸¦ã³ã«ã™ã‚‹ï¼‰ */
.header-row {
  display: flex;
  justify-content: space-between; /* ä¸¡ç«¯æƒãˆ */
  align-items: center;            /* ä¸Šä¸‹ä¸­å¤®æƒãˆ */
  margin-bottom: 20px;
  border-bottom: 2px solid #eee;
  padding-bottom: 10px;
}
h2, h3 { margin: 0; color: #B71C1C; }

/* ï¼Ÿãƒœã‚¿ãƒ³ï¼ˆç¢ºå®Ÿã«è¡¨ç¤ºã•ã‚Œã‚‹ã‚¹ã‚¿ã‚¤ãƒ«ï¼‰ */
.btn-help {
  width: 40px; height: 40px;
  border-radius: 50%;
  background: #666; color: #fff;
  font-size: 20px; font-weight: bold;
  border: none; cursor: pointer;
  display: flex; justify-content: center; align-items: center;
}

/* å…¥åŠ›ãƒ»ãƒœã‚¿ãƒ³å…±é€š */
input, button { width: 100%; margin: 8px 0; padding: 12px; font-size: 16px; border-radius: 6px; border: 1px solid #ccc; }
button { border: none; font-weight: bold; color: #fff; cursor: pointer; transition: opacity 0.2s; }
button:active { transform: scale(0.98); }

/* ãƒœã‚¿ãƒ³ã®è‰²åˆ†ã‘ */
.btn-main { background: #B71C1C; } /* èµ¤ */
.btn-add { background: #2E7D32; }  /* ç·‘ */
.btn-back { background: #616161; } /* ã‚°ãƒ¬ãƒ¼ */
/* å‰Šé™¤ãƒœã‚¿ãƒ³ï¼ˆå°ã•ãèµ¤ãï¼‰ */
.btn-del { 
  background: #f44336; 
  width: auto;             /* å¹…ã‚’è‡ªå‹•èª¿æ•´ */
  margin-left: 10px;       /* æ–‡å­—ã¨ã®é–“éš” */
  padding: 5px 15px; 
  font-size: 14px; 
}

/* ãƒªã‚¹ãƒˆè¡¨ç¤ºã‚¨ãƒªã‚¢ */
.list-area { margin: 15px 0; max-height: 300px; overflow-y: auto; }
.list-item { 
  display: flex; 
  justify-content: space-between; /* æ–‡å­—ã¨å‰Šé™¤ãƒœã‚¿ãƒ³ã‚’å·¦å³ã« */
  align-items: center; 
  border-bottom: 1px solid #eee; 
  padding: 10px 0; 
}

/* ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆãƒ˜ãƒ«ãƒ—ç”»é¢ï¼‰ */
.modal-overlay {
  position: fixed; top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.7);
  z-index: 9999; /* æœ€å‰é¢ */
  display: flex; justify-content: center; align-items: center;
}
.modal-content {
  background: #fff; width: 90%; max-width: 450px;
  padding: 25px; border-radius: 10px;
}

/* å‡ºèµ°è¡¨ãƒ†ãƒ¼ãƒ–ãƒ« */
table { width: 100%; border-collapse: collapse; margin-top: 10px; }
th, td { border: 1px solid #ccc; padding: 10px; text-align: center; font-size: 14px; }
th { background: #eee; }
/* æ ç•ªã”ã¨ã®è‰² */
.waku-1 { color: #000; } .waku-2 { background: #333; color: #fff; }
.waku-3 { background: #f44336; color: #fff; } .waku-4 { background: #2196f3; color: #fff; }
.waku-5 { background: #ffeb3b; color: #000; } .waku-6 { background: #4caf50; color: #fff; }
.waku-7 { background: #ff9800; color: #fff; } .waku-8 { background: #ffc0cb; color: #000; }
</style>
</head>
<body>

<div id="modal-help" class="modal-overlay hidden">
  <div class="modal-content">
    <h3>ğŸ“– éŠã³æ–¹</h3>
    <ul style="padding-left: 20px; line-height: 1.8;">
      <li><b>ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç™»éŒ²ï¼š</b> é ¼ã‚€æ–™ç†ãƒ»ãƒ‰ãƒªãƒ³ã‚¯ã‚’3ã¤ä»¥ä¸Šå…¥åŠ›ã€‚ï¼ˆæœ€å¤§8å“ï¼‰</li>
      <li><b>å‡ºèµ°è¡¨ï¼š</b> ã€Œå‡ºèµ°è¡¨ã‚’ç¢ºèªã€ã§ã‚ªãƒƒã‚ºã‚’è¡¨ç¤ºã€‚</li>
      <li><b>äºˆæƒ³ï¼š</b> å‚åŠ è€…ã‚’ç™»éŒ²ã—ã€æ–™ç†ã®åˆ°ç€é †ï¼ˆ1ã€œ3ç€ï¼‰ã‚’äºˆæƒ³ã€‚</li>
      <li><b>çµæœï¼š</b> æ–™ç†ãŒå±Šã„ãŸé †ã«å…¥åŠ›ã—ã¦çµæœç™ºè¡¨ï¼</li>
    </ul>
    <button type="button" class="btn-main" onclick="toggleModal()">é–‰ã˜ã‚‹</button>
  </div>
</div>

<div id="screen-menu" class="box">
  <div class="header-row">
    <h2>ç‹å°†ãƒ€ãƒ¼ãƒ“ãƒ¼</h2>
    <button type="button" class="btn-help" onclick="toggleModal()">ï¼Ÿ</button>
  </div>

  <input id="shopName" placeholder="ãŠåº—ã®åå‰ï¼ˆä¾‹ï¼šå¤§é˜ªç‹å°†ï¼‰">
  <input id="menuName" placeholder="ãƒ¡ãƒ‹ãƒ¥ãƒ¼åï¼ˆä¾‹ï¼šé¤ƒå­ï¼‰">
  <button type="button" class="btn-add" onclick="addMenu()">ï¼‹ ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’è¿½åŠ </button>
  
  <div id="menuList" class="list-area">
    <div style="color:#888; text-align:center;">ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’è¿½åŠ ã—ã¦ãã ã•ã„</div>
  </div>
  
  <button type="button" class="btn-main" onclick="toRaceTable()">ğŸ å‡ºèµ°è¡¨ã‚’ç¢ºèª</button>
  <button type="button" class="btn-back" onclick="resetAll()">ğŸ—‘ï¸ æœ€åˆã‹ã‚‰ã‚„ã‚Šç›´ã™</button>
</div>

<div id="screen-race" class="box hidden">
  <h3>ğŸ å‡ºèµ°è¡¨</h3>
  <div id="raceTableArea"></div>
  <button type="button" class="btn-add" style="margin-top:15px;" onclick="toPlayerReg()">å‚åŠ è€…ç™»éŒ²ã¸é€²ã‚€</button>
  <button type="button" class="btn-back" onclick="show('screen-menu')">ãƒ¡ãƒ‹ãƒ¥ãƒ¼ä¿®æ­£ã«æˆ»ã‚‹</button>
</div>

<div id="screen-player" class="box hidden">
  <h3>ğŸ‘¤ å‚åŠ è€…ç™»éŒ²</h3>
  <input id="playerName" placeholder="åå‰ã‚’å…¥åŠ›">
  <button type="button" class="btn-add" onclick="addPlayer()">ï¼‹ å‚åŠ è€…ã‚’è¿½åŠ </button>
  <div id="playerList" class="list-area">å‚åŠ è€…ãŒã„ã¾ã›ã‚“</div>
  <button type="button" class="btn-main" onclick="startPrediction()">äºˆæƒ³ã‚’å§‹ã‚ã‚‹</button>
  <button type="button" class="btn-back" onclick="show('screen-race')">æˆ»ã‚‹</button>
</div>

<div id="screen-predict" class="box hidden">
  <h3 id="predictTitle">äºˆæƒ³ç”»é¢</h3>
  <p>1ç€ã€œ3ç€ã‚’é¸ã‚“ã§ãã ã•ã„</p>
  <div id="predictInputs"></div>
  <div id="menuButtons"></div>
  <button type="button" class="btn-main" onclick="confirmPrediction()">æ±ºå®š</button>
</div>

<div id="screen-result" class="box hidden">
  <h3>ğŸ† çµæœå…¥åŠ›</h3>
  <p>å±Šã„ãŸæ–™ç†ã‚’é †ç•ªã«é¸ã‚“ã§ãã ã•ã„</p>
  <div id="resultInputs"></div>
  <div id="resultButtons"></div>
  <button type="button" class="btn-main" onclick="showResult()">çµæœç™ºè¡¨ï¼</button>
</div>

<div id="screen-ticket" class="box hidden">
  <div style="text-align:center; border: 2px solid #333; padding: 20px; border-radius: 10px;">
    <h2 id="finalTitle">çµæœç™ºè¡¨</h2>
    <div id="finalResult" style="font-size:16px; margin:15px 0; line-height:1.6;"></div>
    <div id="finalOdds" style="color:#B71C1C; font-size:22px; font-weight:900;"></div>
    <hr>
    <div id="finalWinners" style="color:green; font-weight:bold; font-size:18px;"></div>
  </div>
  <button type="button" class="btn-back" onclick="resetAll()">ã‚¿ã‚¤ãƒˆãƒ«ã¸æˆ»ã‚‹</button>
</div>

<script>
/* --- å¤‰æ•°ç®¡ç† --- */
let menus = [];
let players = [];
let currentPlayerIndex = 0;
let tempPrediction = [null, null, null];
let tempResult = [null, null, null];
let activeSlot = 0;

const $ = (id) => document.getElementById(id);

/* --- ç”»é¢é·ç§»é–¢æ•° --- */
function show(screenId) {
  // ã™ã¹ã¦ã®ç”»é¢ã‚’éš ã™
  ['screen-menu','screen-race','screen-player','screen-predict','screen-result','screen-ticket'].forEach(id => {
    $(id).classList.add('hidden');
  });
  // æŒ‡å®šã—ãŸç”»é¢ã ã‘è¡¨ç¤º
  $(screenId).classList.remove('hidden');
  window.scrollTo(0,0);
}

/* --- ãƒ˜ãƒ«ãƒ—ï¼ˆãƒ¢ãƒ¼ãƒ€ãƒ«ï¼‰é–‹é–‰ --- */
function toggleModal() {
  const m = $('modal-help');
  // hiddenã‚¯ãƒ©ã‚¹ã®ä»˜ã‘å¤–ã—ã§åˆ¶å¾¡
  if(m.classList.contains('hidden')) {
    m.classList.remove('hidden');
  } else {
    m.classList.add('hidden');
  }
}

/* --- ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç®¡ç† --- */
function addMenu() {
  const val = $('menuName').value.trim();
  if(!val) return;
  // ãƒ©ãƒ³ãƒ€ãƒ ã‚ªãƒƒã‚ºç”Ÿæˆ
  const odds = (Math.random() * 8 + 1.1).toFixed(1);
  menus.push({ name: val, odds: odds });
  $('menuName').value = '';
  renderMenus();
}

function renderMenus() {
  const list = $('menuList');
  if(menus.length === 0) {
    list.innerHTML = '<div style="text-align:center; color:#888;">ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’è¿½åŠ ã—ã¦ãã ã•ã„</div>';
    return;
  }
  // â˜…å‰Šé™¤ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤ºã™ã‚‹HTMLã‚’ç”Ÿæˆâ˜…
  list.innerHTML = menus.map((m, i) => `
    <div class="list-item">
      <span style="font-weight:bold;">${i+1}. ${m.name}</span>
      <button type="button" class="btn-del" onclick="removeMenu(${i})">å‰Šé™¤</button>
    </div>
  `).join('');
}

function removeMenu(index) {
  menus.splice(index, 1); // é…åˆ—ã‹ã‚‰å‰Šé™¤
  renderMenus();          // å†æç”»
}

/* --- å‡ºèµ°è¡¨ç”Ÿæˆ --- */
function toRaceTable() {
  if(menus.length < 3) return alert("ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’3ã¤ä»¥ä¸Šç™»éŒ²ã—ã¦ãã ã•ã„ï¼ˆãƒ¬ãƒ¼ã‚¹ãŒæˆç«‹ã—ã¾ã›ã‚“ï¼‰");
  
  let html = '<table><tr><th>æ </th><th>ãƒ¡ãƒ‹ãƒ¥ãƒ¼å</th><th>ã‚ªãƒƒã‚º</th></tr>';
  menus.forEach((m, i) => {
    // æ ç•ªï¼ˆ1ã€œ8ï¼‰ã‚’è¨ˆç®—
    const waku = Math.min(8, Math.floor(i / Math.max(1, menus.length/8)) + 1);
    html += `<tr><td class="waku-${waku}">${i+1}</td><td>${m.name}</td><td>${m.odds}å€</td></tr>`;
  });
  html += '</table>';
  
  $('raceTableArea').innerHTML = html;
  show('screen-race'); // ç”»é¢é·ç§»
}

/* --- å‚åŠ è€…ç®¡ç† --- */
function toPlayerReg() { show('screen-player'); }

function addPlayer() {
  const val = $('playerName').value.trim();
  if(!val) return;
  players.push({ name: val, prediction: [] });
  $('playerName').value = '';
  renderPlayers();
}

function renderPlayers() {
  const list = $('playerList');
  if(players.length === 0) {
    list.innerHTML = 'å‚åŠ è€…ãŒã„ã¾ã›ã‚“';
    return;
  }
  list.innerHTML = players.map(p => `<div class="list-item">ğŸ‘¤ ${p.name}</div>`).join('');
}

/* --- äºˆæƒ³ãƒ­ã‚¸ãƒƒã‚¯ --- */
function startPrediction() {
  if(players.length === 0) return alert("å‚åŠ è€…ã‚’è¿½åŠ ã—ã¦ãã ã•ã„");
  currentPlayerIndex = 0;
  setupPredictionScreen();
}

function setupPredictionScreen() {
  // å…¨å“¡ã®äºˆæƒ³ãŒçµ‚ã‚ã£ãŸã‚‰çµæœå…¥åŠ›ã¸
  if(currentPlayerIndex >= players.length) {
    setupResultScreen();
    return;
  }
  const p = players[currentPlayerIndex];
  $('predictTitle').innerText = `äºˆæƒ³ï¼š${p.name} ã•ã‚“`;
  tempPrediction = [null, null, null];
  activeSlot = 0;
  renderPredictionUI();
  show('screen-predict');
}

function renderPredictionUI() {
  const labels = ['1ç€','2ç€','3ç€'];
  let html = '';
  for(let i=0; i<3; i++) {
    const menuIdx = tempPrediction[i];
    const text = menuIdx !== null ? menus[menuIdx].name : 'ï¼ˆæœªé¸æŠï¼‰';
    const activeStyle = (i === activeSlot) ? 'background:#FFF3E0; border:2px solid orange;' : 'background:#fff;';
    html += `<div style="padding:10px; margin:5px 0; border:1px solid #ddd; border-radius:4px; ${activeStyle}" onclick="activeSlot=${i}; renderPredictionUI();">
      <b>${labels[i]}</b> : ${text}
    </div>`;
  }
  $('predictInputs').innerHTML = html;

  // é¸æŠãƒœã‚¿ãƒ³
  $('menuButtons').innerHTML = menus.map((m, i) => `
    <button type="button" style="margin:4px 0; background:#eee; color:#333; text-align:left;" 
      onclick="selectMenuForPrediction(${i})" ${tempPrediction.includes(i) ? 'disabled style="opacity:0.3"' : ''}>
      ${i+1}. ${m.name} (${m.odds}å€)
    </button>
  `).join('');
}

function selectMenuForPrediction(idx) {
  tempPrediction[activeSlot] = idx;
  const next = tempPrediction.indexOf(null);
  if(next !== -1) activeSlot = next;
  renderPredictionUI();
}

function confirmPrediction() {
  if(tempPrediction.includes(null)) return alert("1ç€ã‹ã‚‰3ç€ã¾ã§ã™ã¹ã¦é¸ã‚“ã§ãã ã•ã„");
  players[currentPlayerIndex].prediction = [...tempPrediction];
  currentPlayerIndex++;
  setupPredictionScreen();
}

/* --- çµæœå…¥åŠ› --- */
function setupResultScreen() {
  tempResult = [null, null, null];
  activeSlot = 0;
  renderResultUI();
  show('screen-result');
}

function renderResultUI() {
  const labels = ['1ç€','2ç€','3ç€'];
  let html = '';
  for(let i=0; i<3; i++) {
    const menuIdx = tempResult[i];
    const text = menuIdx !== null ? menus[menuIdx].name : 'ï¼ˆæœªé¸æŠï¼‰';
    const activeStyle = (i === activeSlot) ? 'background:#FFF3E0; border:2px solid orange;' : 'background:#fff;';
    html += `<div style="padding:10px; margin:5px 0; border:1px solid #ddd; border-radius:4px; ${activeStyle}" onclick="activeSlot=${i}; renderResultUI();">
      <b>${labels[i]}</b> : ${text}
    </div>`;
  }
  $('resultInputs').innerHTML = html;

  $('resultButtons').innerHTML = menus.map((m, i) => `
    <button type="button" style="margin:4px 0; background:#eee; color:#333; text-align:left;" 
      onclick="selectMenuForResult(${i})" ${tempResult.includes(i) ? 'disabled style="opacity:0.3"' : ''}>
      ${i+1}. ${m.name}
    </button>
  `).join('');
}

function selectMenuForResult(idx) {
  tempResult[activeSlot] = idx;
  const next = tempResult.indexOf(null);
  if(next !== -1) activeSlot = next;
  renderResultUI();
}

/* --- çµæœç™ºè¡¨ --- */
function showResult() {
  if(tempResult.includes(null)) return alert("ã™ã¹ã¦ã®çµæœã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
  
  const shop = $('shopName').value || 'ç‹å°†';
  $('finalTitle').innerText = `${shop} ã‚°ãƒ©ãƒ³ãƒ—ãƒª`;
  
  let totalOdds = 1.0;
  const resHtml = tempResult.map((idx, i) => {
    totalOdds *= parseFloat(menus[idx].odds);
    return `${i+1}ç€: ${menus[idx].name}`;
  }).join('<br>');
  
  $('finalResult').innerHTML = resHtml;
  $('finalOdds').innerText = `3é€£å˜: ${totalOdds.toFixed(1)}å€`;
  
  const winners = players.filter(p => JSON.stringify(p.prediction) === JSON.stringify(tempResult));
  
  if(winners.length > 0) {
    $('finalWinners').innerHTML = `ğŸ‰ çš„ä¸­ï¼<br>${winners.map(w=>w.name).join(', ')}`;
  } else {
    $('finalWinners').innerText = 'çš„ä¸­è€…ãªã—...';
  }
  
  show('screen-ticket');
}

function resetAll() {
  if(!confirm("ãƒ‡ãƒ¼ã‚¿ã‚’ã™ã¹ã¦æ¶ˆã—ã¦æœ€åˆã‹ã‚‰æˆ»ã‚Šã¾ã™ã‹ï¼Ÿ")) return;
  menus = [];
  players = [];
  currentPlayerIndex = 0;
  $('menuList').innerHTML = '<div style="text-align:center; color:#888;">ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’è¿½åŠ ã—ã¦ãã ã•ã„</div>';
  $('playerList').innerHTML = 'å‚åŠ è€…ãŒã„ã¾ã›ã‚“';
  $('shopName').value = '';
  $('menuName').value = '';
  $('playerName').value = '';
  show('screen-menu');
}
</script>
</body>
</html>
